<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.QuizDao">

	<!-- 插入一个问卷填写情况 -->
	<insert id="insertQuiz" useGeneratedKeys="true"  keyProperty="quizId">
		INSERT INTO quiz(class_id, user_id, course_id, date, quiz_detail_id, fill1, fill2) 
		VALUES(#{classId}, #{userId}, #{courseId}, #{date}, #{quizDetailId}, #{fill1}, #{fill2}); 
	</insert>
	
	<!-- 插入一个问卷 -->
	<insert id="insertQuizDetail" useGeneratedKeys="true"  keyProperty="quizDetaiId">
		INSERT INTO quiz_detail(question1,question2) VALUES(#{question1}, #{question2});
	</insert>
	
	<!-- 根据班级和课程得到问卷填写情况 -->
	<select id="getQuizsByClassIdAndCourseId" resultType="entity.Quiz">
		SELECT quiz_id, class_id, user_id, course_id, date, quiz_detail_id, fill1, fill2
		FROM quiz WHERE class_id = #{classId} AND course_id = #{courseId};
	</select>
	
	<!-- 根据用户得到问卷填写情况 -->
	<select id="getQuizsByUserId" resultType="entity.Quiz">
		SELECT quiz_id, class_id, user_id, course_id, date, quiz_detail_id, fill1, fill2
		FROM quiz WHERE user_id = #{userId};
	</select>
	
	<!-- 得到所有问卷填写情况 -->
	<select id="getAllQuizs" resultType="entity.Quiz">
		SELECT quiz_id, class_id, user_id, course_id, date, quiz_detail_id, fill1, fill2
		FROM quiz ;
	</select>
	
	<!-- 得到问卷问题 -->
	<select id="getQuizDetailByQuizDetailId" resultType="entity.QuizDetail">
		SELECT quiz_detail_id, question1, question2 FROM quiz_detail WHERE quiz_detail_id = #{quizDetailId};
	</select>
	
	<!-- 根据班级和课程得到问卷填写情况 -->
	<select id="getQuizsByClassIdAndCourseIdWithDetail" resultType="entity.Quiz">
		SELECT q.quiz_id, q.class_id, q.user_id, q.course_id, q.date, q.quiz_detail_id, q.fill1, q.fill2,
		qd.quiz_detail_id as "quizDetail.quizDetailId",qd.question1 as "quizDetail.question1", qd.question2 as "quizDetail.question2"
		FROM quiz q INNER JOIN quiz_detail qd ON q.quiz_detail_id = qd.quiz_detail_id
		WHERE class_id = #{classId} AND course_id = #{courseId};
	</select>




</mapper>