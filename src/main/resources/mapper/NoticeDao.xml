<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="dao.NoticeDao">

	<!-- 插入一条具体通知，并返回自增主键 -->
	<insert id="insertNoticeDetail" useGeneratedKeys="true" keyProperty="noticeDetailId">
		INSERT INTO notice_detail(content) VALUES(#{content});
	</insert>
	
	<!-- 插入一条通知，并返回自增主键 -->
	<insert id="insertNotice" useGeneratedKeys="true" keyProperty="noticeId">
		INSERT INTO notice(class_id, user_id, course_id, date, notice_detail_id) 
		VALUES(#{classId}, #{userId}, #{courseId}, #{date}, #{noticeDetailId});
	</insert>
	
	<!-- 通过班级id和具体通知id更新具体通知 -->
	<update id="updateNoticeByClassIdAndNoticeDetailId">
		UPDATE notice
		<set>
		  <if test="classId != null">class_Id= #{classId},</if>
		  <if test="userId != null">user_id = #{userId},</if>
		  <if test="courseId != null">course_id = #{courseId},</if>
		  <if test="date != null">date = #{date},</if>
		  <if test="noticeDetailId != null">notice_detail_id = #{noticeDetailId},</if>
 		</set>
 		WHERE class_id = #{classId} AND notice_detail_id = #{noticeDetailId};
	</update>
	
	<!-- 通过具体通知id更新具体通知 -->
	<update id="updateNoticeDetailByNoticeDetailId">
		UPDATE notice_detail
		<set>
		  <if test="content != null">content= #{content},</if>
 		</set>
 		WHERE notice_detail_id = #{noticeDetailId};
	</update>
	
	<select id="getNoticesByClassId" resultType="entity.Notice">
		SELECT n.notice_id, n.class_id, n.user_id, n.course_id, n.date, n.notice_detail_id,
		nd.notice_detail_id as "noticeDetail.noticeDetailId" ,nd.content as "noticeDetail.content"
		FROM notice n INNER JOIN notice_detail nd ON n.notice_detail_id = nd.notice_detail_id
		WHERE n.class_id = #{classId}; 
	</select>
	
	<select id="getNoticesByUserId" resultType="entity.Notice">
		SELECT n.notice_id, n.class_id, n.user_id, n.course_id, n.date, n.notice_detail_id,
		nd.notice_detail_id as "noticeDetail.noticeDetailId" ,nd.content as "noticeDetail.content"
		FROM notice n INNER JOIN notice_detail nd ON n.notice_detail_id = nd.notice_detail_id
		WHERE n.user_id = #{userId}; 
	</select>

</mapper>